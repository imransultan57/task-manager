<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">üìã Task Manager</h1>

        <!-- Add Task Form -->
        <div class="card p-3 mb-4 shadow-sm">
            <form id="taskForm">
                <div class="mb-3">
                    <label class="form-label">Title</label>
                    <input type="text" id="title" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Description</label>
                    <textarea id="description" class="form-control" rows="2" required></textarea>
                </div>
                <button class="btn btn-primary w-100" type="submit">Add Task</button>
            </form>
        </div>

        <!-- Task List -->
        <div id="taskList" class="list-group shadow-sm"></div>
    </div>

    <script>
        const API_URL = "http://localhost:8090/tasks";

        async function fetchTasks() {
            const res = await fetch(API_URL);
            const tasks = await res.json();
            const list = document.getElementById("taskList");
            list.innerHTML = "";

            tasks.forEach(task => {
                const item = document.createElement("div");
                item.className = "list-group-item";

                item.innerHTML = `
        <div id="view-${task.id}" class="d-flex justify-content-between align-items-center">
          <div>
            <h5>${task.title}</h5>
            <p class="mb-1">${task.description}</p>
            <small>${task.completed ? "‚úÖ Completed" : "‚è≥ Pending"}</small>
          </div>
          <div>
            <button class="btn btn-success btn-sm me-2" onclick="toggleComplete('${task.id}', ${!task.completed})">‚úî</button>
            <button class="btn btn-warning btn-sm me-2" onclick="editTask('${task.id}', '${task.title}', '${task.description}')">‚úèÔ∏è</button>
            <button class="btn btn-danger btn-sm" onclick="deleteTask('${task.id}')">üóë</button>
          </div>
        </div>

        <!-- Hidden edit form -->
        <form id="edit-${task.id}" class="d-none mt-3">
          <input type="text" class="form-control mb-2" id="edit-title-${task.id}" value="${task.title}" required>
          <textarea class="form-control mb-2" id="edit-desc-${task.id}" rows="2" required>${task.description}</textarea>
          <button type="button" class="btn btn-primary btn-sm" onclick="updateTask('${task.id}')">üíæ Save</button>
          <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('${task.id}')">‚ùå Cancel</button>
        </form>
      `;
                list.appendChild(item);
            });
        }

        async function addTask(e) {
            e.preventDefault();
            const title = document.getElementById("title").value;
            const description = document.getElementById("description").value;

            await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, description, completed: false })
            });

            e.target.reset();
            fetchTasks();
        }

        async function deleteTask(id) {
            await fetch(`${API_URL}/${id}`, { method: "DELETE" });
            fetchTasks();
        }

        async function toggleComplete(id, completed) {
            await fetch(`${API_URL}/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ completed })
            });
            fetchTasks();
        }

        function editTask(id, title, description) {
            document.getElementById(`view-${id}`).classList.add("d-none");
            document.getElementById(`edit-${id}`).classList.remove("d-none");
        }

        function cancelEdit(id) {
            document.getElementById(`view-${id}`).classList.remove("d-none");
            document.getElementById(`edit-${id}`).classList.add("d-none");
        }

        async function updateTask(id) {
            const title = document.getElementById(`edit-title-${id}`).value;
            const description = document.getElementById(`edit-desc-${id}`).value;

            await fetch(`${API_URL}/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, description })
            });

            fetchTasks();
        }

        document.getElementById("taskForm").addEventListener("submit", addTask);
        fetchTasks();
    </script>

</body>

</html>